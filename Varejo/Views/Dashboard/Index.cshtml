@model Varejo.ViewModels.DashboardViewModel
@{
	ViewData["Title"] = "Dashboard";
}

<h2 class="mb-4">📊 @ViewData["Title"]</h2>

<div class="container-fluid py-3">

	<!-- ===================== -->
	<!-- KPIs CARDS -->
	<!-- ===================== -->
	<div class="row g-3 mb-4">
		@* Produtos *@
		<div class="col-6 col-md-3">
			<div class="card shadow-sm h-100 text-center">
				<div class="card-body">
					<div class="fs-1 fw-bold">@Model.TotalProdutos</div>
					<div class="fs-5">Produtos</div> 
				</div>
			</div>
		</div>

		@* Categorias *@
		<div class="col-6 col-md-3">
			<div class="card shadow-sm h-100 text-center">
				<div class="card-body">
					<div class="fs-1 fw-bold">@Model.TotalCategorias</div>
					<div class="fs-5">Categorias</div>
				</div>
			</div>
		</div>

		@* Famílias *@
		<div class="col-6 col-md-3">
			<div class="card shadow-sm h-100 text-center">
				<div class="card-body">
					<div class="fs-1 fw-bold">@Model.TotalFamilias</div>
					<div class="fs-5">Famílias</div>
				</div>
			</div>
		</div>

		@* Marcas *@
		<div class="col-6 col-md-3">
			<div class="card shadow-sm h-100 text-center">
				<div class="card-body">
					<div class="fs-1 fw-bold">@Model.TotalMarcas</div>
					<div class="fs-5">Marcas</div>
				</div>
			</div>
		</div>

		@* Movimentos *@
		<div class="col-6 col-md-3">
			<div class="card shadow-sm h-100 text-center">
				<div class="card-body">
					<div class="fs-1 fw-bold">@Model.TotalMovimentos</div>
					<div class="fs-5">Movimentos</div>
				</div>
			</div>
		</div>

		@* Produtos Movimentados *@
		<div class="col-6 col-md-3">
			<div class="card shadow-sm h-100 text-center">
				<div class="card-body">
					<div class="fs-1 fw-bold">@Model.TotalProdutosMovimentados</div>
					<div class="fs-5">Produtos Movimentados</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ===================== -->
	<!-- Últimos produtos / Produtos por categoria -->
	<!-- ===================== -->
	<div class="row g-3 mb-4">
		<div class="col-12 col-lg-6">
			<div class="card shadow-sm h-100">
				<div class="card-header fw-semibold">🆕 Últimos 5 Produtos</div>
				<div class="card-body p-2">
					@if (Model.UltimosProdutos?.Count > 0)
					{
						<div class="table-responsive" style="border-radius: 12px; overflow: hidden;">
							<table class="w-100">
								<thead class="table-dark">
									<tr>
										<th>#</th>
										<th>Nome</th>
										<th>Categoria</th>
										<th>Família</th>
									</tr>
								</thead>
								<tbody>
									@foreach (var p in Model.UltimosProdutos)
									{
										<tr>
											<td data-label="#">@p.IdProduto</td>
											<td data-label="Nome">@p.Nome</td>
											<td data-label="Categoria">@p.Categoria</td>
											<td data-label="Família">@p.Familia</td>
										</tr>
									}
								</tbody>
							</table>
						</div>
					}
					else
					{
						<p class="text-muted m-0">Nenhum produto cadastrado ainda.</p>
					}
				</div>
			</div>
		</div>

		<div class="col-12 col-lg-6">
			<div class="card shadow-sm h-100">
				<div class="card-header fw-semibold">📂 Produtos por Categoria</div>
				<div class="card-body p-2">
					@if (Model.ProdutosPorCategoria?.Count > 0)
					{
						<div class="table-responsive" style="border-radius: 12px; overflow: hidden;">
							<table class="w-100">
								<thead class="table-dark">
									<tr>
										<th>#</th>
										<th>Categoria</th>
										<th>Qtd Produtos</th>
									</tr>
								</thead>
								<tbody>
									@foreach (var c in Model.ProdutosPorCategoria)
									{
										<tr>
											<td data-label="#">@c.IdCategoria</td>
											<td data-label="Categoria">@c.Descricao</td>
											<td data-label="Qtd Produtos">@c.QtdeProdutos</td>
										</tr>
									}
								</tbody>
							</table>
						</div>
					}
					else
					{
						<p class="text-muted m-0">Nenhuma categoria cadastrada.</p>
					}
				</div>
			</div>
		</div>
	</div>

	<!-- ===================== -->
	<!-- Produtos por família / Últimos Movimentos -->
	<!-- ===================== -->
	<div class="row g-3 mb-4">
		<div class="col-12 col-lg-6">
			<div class="card shadow-sm h-100">
				<div class="card-header fw-semibold">🏷️ Produtos por Família</div>
				<div class="card-body p-2">
					@if (Model.ProdutosPorFamilia?.Count > 0)
					{
						<div class="table-responsive" style="border-radius: 12px; overflow: hidden;">
							<table class="w-100">
								<thead class="table-dark">
									<tr>
										<th>#</th>
										<th>Família</th>
										<th>Qtd Produtos</th>
									</tr>
								</thead>
								<tbody>
									@foreach (var f in Model.ProdutosPorFamilia)
									{
										<tr>
											<td data-label="#">@f.IdFamilia</td>
											<td data-label="Família">@f.Descricao</td>
											<td data-label="Qtd Produtos">@f.QtdeProdutos</td>
										</tr>
									}
								</tbody>
							</table>
						</div>
					}
					else
					{
						<p class="text-muted m-0">Nenhuma família cadastrada.</p>
					}
				</div>
			</div>
		</div>

		<div class="col-12 col-lg-6">
			<div class="card shadow-sm h-100">
				<div class="card-header fw-semibold">🆕 Últimos 5 Movimentos</div>
				<div class="card-body p-2">
					@if (Model.UltimosMovimentos?.Count > 0)
					{
						<div class="table-responsive" style="border-radius: 12px; overflow: hidden;">
							<table class="w-100">
								<thead class="table-dark">
									<tr>
										<th>#</th>
										<th>Pessoa</th>
										<th>Tipo</th>
										<th>Qtde Produtos</th>
										<th>Data</th>
									</tr>
								</thead>
								<tbody>
									@foreach (var m in Model.UltimosMovimentos)
									{
										<tr>
											<td data-label="#">@m.IdMovimento</td>
											<td data-label="Pessoa">@m.Pessoa</td>
											<td data-label="Tipo">@m.TipoMovimento</td>
											<td data-label="Qtde Produtos">@m.QtdeProdutos</td>
											<td data-label="Data">@m.Data.ToString("dd/MM/yyyy HH:mm")</td>
										</tr>
									}
								</tbody>
							</table>
						</div>
					}
					else
					{
						<p class="text-muted m-0">Nenhum movimento registrado.</p>
					}
				</div>
			</div>
		</div>
	</div>

	<!-- ===================== -->
	<!-- Gráfico Produtos por Categoria -->
	<!-- ===================== -->
	<div class="row g-3 mb-4">
		<div class="col-12">
			<div class="card shadow-sm h-100">
				<div class="card-header fw-semibold">📊 Produtos por Categoria (Gráfico)</div>
				<div class="card-body">
					<canvas id="chartProdutosCategoria"></canvas>
				</div>
			</div>
		</div>
	</div>

</div>
@section Scripts {
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
		const catLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ProdutosPorCategoria.Select(x => x.Descricao)));
		const catData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ProdutosPorCategoria.Select(x => x.QtdeProdutos)));

		new Chart(document.getElementById('chartProdutosCategoria'), {
			type: 'bar',
			data: {
				labels: catLabels,
				datasets: [{
					label: 'Qtd Produtos',
					data: catData,
					backgroundColor: "rgba(34, 211, 238, 0.85)",
					borderColor: "rgba(34, 211, 238, 1)",
					borderWidth: 1
				}]
			},
			options: {
				indexAxis: 'y',
				responsive: true,
				maintainAspectRatio: false,
				plugins: { legend: { display: false } },
				scales: {
					x: { beginAtZero: true, ticks: { stepSize: 1 } },
					y: { ticks: { autoSkip: false } }
				}
			}
		});
		// teste commit
	</script>
}
